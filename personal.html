<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X</title>
    <link rel="stylesheet" href="./css/base.css">
    <link rel="stylesheet" href="./css/zhuye.css">
    <link rel="stylesheet" href="./css/personal.css">
</head>
<body>
    <div class="body1">

        <div class="zuo">
            <a href="./index.html"><img src="./resource/左上角的X.png" alt="[picture]" width="30px" height="30px" style="margin-top: 15px; margin-bottom: 30px;"></a>
            <div class="zuobiaoqian">

                <div class="zhuye">
                    <a href="#">
                        <div>
                            <img src="./resource/主页.png" alt="picture" class="back">
                            <p class="back2">主页</p>
                        </div>
                    </a>
                </div>
                
                <div class="zhuye">
                    <a href="#">
                        <div>
                            <img src="./resource/探索.png" alt="picture">
                            <p>探索</p>
                        </div>
                    </a>
                </div>

                <div class="zhuye">
                    <a href="#">
                        <div>
                            <img src="./resource/通知.png" alt="picture">
                            <p>通知</p>
                        </div>
                    </a>
                </div>

                <div class="zhuye">
                    <a href="#">
                        <div>
                            <img src="./resource/私信.png" alt="picture">
                            <p>私信</p>
                        </div>
                    </a>
                </div>

                <div class="zhuye">
                    <a href="#">
                        <div>
                            <img src="./resource/列表.png" alt="picture">
                            <p>列表</p>
                        </div>
                    </a>
                </div>

                <div class="zhuye">
                    <a href="#">
                        <div>
                            <img src="./resource/书签.png" alt="picture">
                            <p>书签</p>
                        </div>
                    </a>
                </div>

                <div class="zhuye">
                    <a href="#">
                        <div>
                            <img src="./resource/社群.png" alt="picture">
                            <p>社群</p>
                        </div>
                    </a>
                </div>

                <div class="zhuye">
                    <a href="#">
                        <div>
                            <img src="./resource/个人资料.png" alt="picture">
                            <p>个人资料</p>
                        </div>
                    </a>
                </div>

                <div class="zhuye">
                    <a href="#">
                        <div>
                            <img src="./resource/更多.png" alt="picture">
                            <p>更多</p>
                        </div>
                    </a>
                </div>

                <div class="fatie" style="margin-top: 30px;">
                    <a href="#">
                        <div>发帖</div>
                    </a>
                </div>

            </div>

            <div class="ziliao">
                <img src="./resource/atri.png" alt="[picture]" style="margin-right: 5px;" class="tou">
                <div>
                    <p class="leftUserName">Armalite</p>
                    <p class="leftAccount">@Eriri_forever</p>
                </div>
                <a class="sandian" href="#">
                    <img src="./resource/三个点.png" alt="[picture]">
                </a>
            </div>
        </div>

        <div class="zhong">
            <div class="dingbu">


                <div class="tuijian">
                    <a href="#">
                        <div class="Name1">
                            <p class="Name">ArmaLite</p>
                        </div>
                    </a>
                </div>

                <!-- <div class="guanzhuing">
                    <a href="#">
                        <div>
                            <p>正在关注</p>
                            
                        </div> 
                    </a> 
                </div> -->

            </div>

            <div><img src="./resource/bg.jpg" alt="[picture]" width="100%" height="18%"></div>
            <div><img src="./resource/atri.png" alt="" class="zhuyetou"><button class="change">修改资料</button></div>
            <div class="zhuyename">ArmaLite</div>
            <div class="zhuyeaccount">@Eriri_forever</div>

            <div class="jianjie"> AnyOne are there?</div>

            <div class="weizhi">beijing</div>

            <!-- <div class="shengri">生日：</div> -->


            <div><img src="./resource/个人主页页眉.png" alt="" class="yemei"></div>

            <div class="you">
                <div class="sousuo">
                    <input type="text" class="suosouk" placeholder="搜索">
                    <ul class="result-list">
                        <li class="resultsreach"><a href="#" class="result">尝试搜索人物,关键词,或列表</a></li>
                        <li><a href="#">第三次世界大戦</a></li>
                        <li><a href="#">ブルーアーカイブ-Blue Archive-</a></li>
                        <li><a href="#">Russia Ukraine War Report</a></li>
                        <li><a href="#">台灣地震</a></li>
                    </ul>
                </div>
                <div class="xinxianshi">
                    <!-- <h2>有什么新鲜事？</h2> -->
                    <a href="./qaq.html"><img src="./resource/新鲜事.png" alt="[picture]" margin: auto;></a>
                </div>
                <div class="tjgz">
                    <!-- <h2>推荐关注</h2> -->
                    <a href="./qaq.html"><img src="./resource/推荐关注.png" alt="[picture]" margin: auto></a>
                </div>
            </div>
<!-- -------------------------------------------------------------------------------------------------------------------------------------- -->
                            <!-- 推文大框 -->
            <div class="pinglun">
                

            </div>
            <!-- 推文大框 -->
        </div>


        <!-- 发帖模态框 -->
    <div class="modal">   <!--声明一个容器-->
        <div class="modal-content"><!--用来存放要展示的内容-->
            <span class="close-button">&times;
             <a class="caogao">草稿</a>    <!-- 希望右对齐-->
            </span><!-- &times是乘号的意思，用来制作关闭按钮-->
            <br>
            <div class="body002">
            <span><img src="./resource/atri.png" alt="" ></span>
            <form action="" class="tuiWenBiaoDan">
                <input type="text" placeholder="发布您的推文" autocomplete="off" class="faTieShuRu">
                <div class="imgUpLoad"></div>
                <input type="file" name="files" class="photoinput">  <!-- 文件上传 -->
                
                    
                </p>
            </form>
            </div>
            <img src="./resource/图片上传.png" class="photoUpLoad"alt="">
            <img src="./resource/GIF上传.png" alt="">
            <img src="./resource/分点上传.png" alt="">
            <img src="./resource/表情上传.png" alt="">
            <img src="./resource/定时上传.png" alt="">
            <img src="./resource/位置共享.png" alt="">
            <a href="" class="fatieButton"> 发贴</a>
        </div>
    </div>
<!-- 发帖模态框 -->
<!-- ----------------------------------------------------------------------------------- -->
<!-- 修改资料模态框 -->


<div class="personal" style="box-sizing: border-box;">   <!--声明一个容器-->
    <div class="modal-content-personal"><!--用来存放要展示的内容-->
        
        <div>
            <span class="save-button-personal">SAVE</span>
        </div>
        <div class="caogao">
            <span>
                <div class="close-button-personal2">&times;</div>
                
                <div class="a" style="font-size: 20px; color: black;font-weight: 700;">&ensp;编辑个人资料</div>
            </span>    <!-- 希望右对齐-->
        </div><!-- &times是乘号的意思，用来制作关闭按钮-->

        <br>

        <div class="body003">
            <img src="./resource/bg.jpg" width="100%" height="160px" alt="[picture]" style="margin-top: 20px; display: block;" class="backGround">
            <div>
                <br>
                <span>
                    <img src="./resource/atri.png" alt="" class="facePhoto1">
                    <a class="Account">@Eriri_forever</a>
                </span>
            </div>
            <form action="" class="tuiWenBiaoDan">
                <input type="file" name="files" class="backPhotoInput">  <!-- 背景文件上传 -->
                <input type="file" name="files" class="facePhotoInput">  <!-- 头像文件上传 -->

                <input type="text" placeholder="用户名设置" autocomplete="off" class="userNameSet" style="margin-bottom: 28px;">

                <input type="text" placeholder="简介" autocomplete="off" class="briefIntroduction" style="margin-bottom: 28px;">

                <input type="text" placeholder="位置" autocomplete="off" class="position" style="margin-bottom: 28px;">

                <!-- <div class="imgUpLoad"></div>
                <input type="file" name="files" class="photoinput">  文件上传 -->
                
                    
                <p></p>
            </form>
        </div>
        <!-- <img src="./resource/图片上传.png" class="photoUpLoad"alt="">
        <img src="./resource/GIF上传.png" alt="">
        <img src="./resource/分点上传.png" alt="">
        <img src="./resource/表情上传.png" alt="">
        <img src="./resource/定时上传.png" alt="">
        <img src="./resource/位置共享.png" alt="">
        <a href="" class="fatieButton"> 发贴</a> -->
    </div>
</div>

<!-- ----------------------------------------------------------------------------------- -->
        
    </div>
    <script>


        const array = JSON.parse(localStorage.getItem('data')) || []
        const share = JSON.parse(localStorage.getItem('share')) || []//更新share
        let sign = JSON.parse(localStorage.getItem('sign')) || []
        const tuiWen = JSON.parse(localStorage.getItem('tuiWen')) || []   //tuiWen对象数组来记录推文中的各种信息
//////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////
        //头像控制
        const tou = document.querySelector('.tou')
        tou.src = `${sign[(sign.length)-1].tou}`

        
/////////////////////////////////////////////////
//


            // const weizhi = document.querySelector('.weizhi')
            // const jianjie = document.querySelector('.jianjie')

            // weizhi.innerHTML = `位置：${sign[(sign.length)-1].position}`
            // jianjie.innerHTML = sign[(sign.length)-1].jianjie


//更换背景组件
        const backGround = document.querySelector('.backGround')//背景图片
        const backPhotoInput = document.querySelector('.backPhotoInput')//背景图片上传按钮
        backGround.addEventListener('click',function(){
            backPhotoInput.click()

            let temp2 = ''//图片地址缓存

            backPhotoInput.addEventListener('change',function(){
        
            const reader1 = new FileReader()
            reader1.addEventListener('load',function(){
                temp2=reader1.result
                backGround.src = `${reader1.result}`
            // imgUpLoad.src=reader.result
            })
            reader.readAsDataURL(backPhotoInput.files[0])//读取文件URL地址
        // imgUpLoad.innerHTML = `<img src="./resource/atri.png" alt="">`
            })
       

        })


/////////////////////////////////////////////////////////////////////////////////


            const facePhoto = document.querySelector('.facePhoto1')
            facePhoto.src = `${sign[(sign.length)-1].tou}`
//更换头像组件
            const facePhoto1 = document.querySelector('.facePhoto1')//头像图片
            const facePhotoInput = document.querySelector('.facePhotoInput')//头像 图片上传按钮
           

            const zhuyetou = document.querySelector('.zhuyetou')
            zhuyetou.src = `${sign[(sign.length)-1].tou}`
            facePhoto1.addEventListener('click',function(){
                facePhotoInput.click()

                let temp='1' //图片地址缓存
                facePhotoInput.addEventListener('change',function(){
            
                const reader2 = new FileReader()
                reader2.addEventListener('load',function(){
                    temp = reader2.result;
                    let sign = JSON.parse(localStorage.getItem('sign')) || []
                    sign[sign.length-1].tou = temp
                    let k=0;
                    for(let i = 0;i<array.length;i++)
                    {
                        if(String(array[i].account)===String(sign[sign.length-1].account))
                        {
                            k=i;
                        }
                    }
                    array[k].tou = temp
                    localStorage.setItem('data',JSON.stringify(array))//压入
                    localStorage.setItem('sign',JSON.stringify(sign))

                })
                    facePhoto1.src = `${reader2.result}`
                    reader2.readAsDataURL(facePhotoInput.files[0])//读取文件URL地址
                // imgUpLoad.src=reader.result
                })
                
            // imgUpLoad.innerHTML = `<img src="./resource/atri.png" alt="">`

           
                
            })




 ////////////////////////////////////////////////////////////////////////////////
        // 回退组件
        const back = document.querySelector('.back')
        back.addEventListener('click',function(){
            location.href ='zhuye.html'
        })



        const back2 = document.querySelector('.back2')
        back2.addEventListener('click',function(){
            location.href ='zhuye.html'
        })
        /////////////////////////////////////////////////////////////////////////////////
//名字设置

        



/////////////////////////////////////////////////////////////////////////////////
          //左下角名字控制
          function getTextBeforeChar(str, char) {
            var index = str.indexOf(char);
            if (index !== -1) {
                return str.substring(0, index);
            }
            return str; // 如果字符不存在，返回原字符串
        }
        const leftUserName = document.querySelector('.leftUserName')
        const leftAccount = document.querySelector('.leftAccount')
       
        const originalText = `${sign[(sign.length)-1].account}`
        const char = "@";
        const textBeforeChar = getTextBeforeChar(originalText, char);
        leftUserName.innerHTML = sign[(sign.length)-1].uname
        leftAccount.innerHTML = `@${textBeforeChar}`



        //名字控制
        const Account = document.querySelector('.Account')
        Account.innerHTML = `${sign[sign.length-1].account}`

        const zhuyename = document.querySelector('.zhuyename')
        zhuyename.innerHTML = `${sign[sign.length-1].uname}`

        const zhuyeaccount = document.querySelector('.zhuyeaccount')
        zhuyeaccount.innerHTML = Account.innerHTML = `${sign[sign.length-1].account}`

        const Name = document.querySelector('.Name')
        Name.innerHTML = `< ${sign[sign.length-1].uname}`


///////////////////////////////////////////////////////////////////////////
        //个人资料设置
        // 发帖模块框开关控制
        const close_button_personal2 = document.querySelector('.close-button-personal2')
        const change = document.querySelector('.change')//修改按钮
        const personal = document.querySelector('.personal')//修改按钮
        const saveclosebutton = document.querySelector('.save-button-personal')
        change.addEventListener('click',function(){
            
            personal.classList.toggle('active-personal')
        })
        close_button_personal2.addEventListener('click',function(){
            personal.classList.toggle('active-personal')
        })
        saveclosebutton.addEventListener('click',function(){
            //先储存数据再关闭框
            const userNameSet = document.querySelector('.userNameSet')
            const briefIntroduction = document.querySelector('.briefIntroduction')
            const position = document.querySelector('.position')
            //一切名字，账号都是由sign数组储存控制的
            //一切用户数据都是由data储存的，而sign是基于data改动的,array数组是data的代言
            let i = 0
            let k = 0
            for(i = 0;i<array.length;i++)
            {
                if(String(array[i].account)===String(sign[sign.length-1].account))
                {
                    k=i
                }
            }
            
            array[k].uname = userNameSet.value
            array[k].jianjie = briefIntroduction.value
            array[k].position = position.value

            localStorage.setItem('data',JSON.stringify(array))//把array中的数据覆盖到data上面
            sign[sign.length-1].uname = userNameSet.value
            sign[sign.length-1].jianjie = briefIntroduction.value
            sign[sign.length-1].position = position.value
            localStorage.setItem('sign',JSON.stringify(sign))//把数据压入sign
            leftUserName.innerHTML = sign[(sign.length)-1].uname//重置一下左下角的名字
            const jianjie = document.querySelector('.jianjie')
            jianjie.innerHTML = sign[(sign.length)-1].jianjie
            const weizhi = document.querySelector('.weizhi')
            weizhi.innerHTML = `位置：${sign[(sign.length)-1].position}`



            
            //推文中发布者的名字也要修改
            for(i = 0;i<tuiWen.length;i++)
            {
                if(String(tuiWen[i].account)===String(sign[sign.length-1].account))
                {
                    tuiWen[i].uname = userNameSet.value
                }
            }
            localStorage.setItem('tuiWen',JSON.stringify(tuiWen))//把数据压入tuiWen
            personal.classList.toggle('active-personal')
        })
///////////////////////////////////////////////////////////////////////////////////////
        // 发帖模块框开关控制
        const fatie = document.querySelector('.fatie')
        const modal = document.querySelector('.modal')
        const close = document.querySelector('.close-button')
        fatie.addEventListener('click',function(){
            modal.classList.toggle('active')
        })
        close.addEventListener('click',function(){
            modal.classList.toggle('active')
        })
    </script>
</body>
</html>